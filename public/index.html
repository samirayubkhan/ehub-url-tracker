<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eHub URL Tracker Dashboard</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8fafc;
        }
        .header {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .metric {
            font-size: 2em;
            font-weight: bold;
            color: #1e40af;
            margin-bottom: 5px;
        }
        .metric-label {
            color: #64748b;
            font-size: 0.9em;
        }
        .channel-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e5e7eb;
        }
        .channel-item:last-child {
            border-bottom: none;
        }
        .loading {
            text-align: center;
            padding: 40px;
            color: #64748b;
        }
        .error {
            background: #fee2e2;
            border: 1px solid #fecaca;
            color: #dc2626;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .refresh-btn {
            background: #1e40af;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        .refresh-btn:hover {
            background: #1d4ed8;
        }
        .last-updated {
            color: #64748b;
            font-size: 0.9em;
            margin-left: 15px;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>eHub URL Tracker Dashboard</h1>
        <p>Track clicks for your ALX eHub migration URLs</p>
        <button class="refresh-btn" onclick="loadStats()">Refresh Data</button>
        <span class="last-updated" id="lastUpdated"></span>
    </div>

    <div id="loading" class="loading">
        Loading statistics...
    </div>

    <div id="error" class="error" style="display: none;"></div>

    <div id="dashboard" style="display: none;">
        <div class="stats-grid">
            <div class="card">
                <div class="metric" id="totalClicks">0</div>
                <div class="metric-label">Total Clicks</div>
            </div>
            <div class="card">
                <div class="metric" id="channelCount">0</div>
                <div class="metric-label">Active Channels</div>
            </div>
            <div class="card">
                <div class="metric" id="recentClicks">0</div>
                <div class="metric-label">Clicks (Last 24h)</div>
            </div>
        </div>

        <div class="card">
            <h3>Clicks by Channel</h3>
            <div id="channelStats">
                <div class="loading">No data available</div>
            </div>
        </div>

        <div class="card">
            <h3>Your Tracking URLs</h3>
            <p>Use these URLs to track different traffic sources. Choose between short URLs (better for WhatsApp) or long URLs (more descriptive):</p>
            
            <div style="margin: 20px 0;">
                <label style="margin-right: 15px;">
                    <input type="radio" name="urlType" value="short" checked onchange="toggleUrlDisplay()"> Short URLs (Recommended for WhatsApp)
                </label>
                <label>
                    <input type="radio" name="urlType" value="long" onchange="toggleUrlDisplay()"> Long URLs (Descriptive)
                </label>
            </div>
            
            <div style="font-family: monospace; background: #f1f5f9; padding: 15px; border-radius: 6px; margin-top: 10px;">
                <div style="margin: 5px 0;"><strong>Home Banner:</strong> <span id="homeBannerUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>Announcement Post:</strong> <span id="announcementUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>DM 1:</strong> <span id="dm1Url">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>DM 2:</strong> <span id="dm2Url">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>DM 3:</strong> <span id="dm3Url">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>Channel Banner:</strong> <span id="channelBannerUrl">Loading...</span></div>
                <hr style="margin: 15px 0; border: none; border-top: 1px solid #e2e8f0;">
                <div style="margin: 5px 0;"><strong>WhatsApp - Lagos:</strong> <span id="whatsappLagosUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Johannesburg:</strong> <span id="whatsappJohannesburgUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Kigali:</strong> <span id="whatsappKigaliUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Nairobi:</strong> <span id="whatsappNairobiUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Casablanca:</strong> <span id="whatsappCasablancaUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Cairo:</strong> <span id="whatsappCairoUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Addis Ababa:</strong> <span id="whatsappAddisAbabaUrl">Loading...</span></div>
                <div style="margin: 5px 0;"><strong>WhatsApp - Accra:</strong> <span id="whatsappAccraUrl">Loading...</span></div>
            </div>
        </div>
    </div>

    <script>
        let baseUrl = '';
        let urlMappings = {};
        
        async function initializeUrls() {
            baseUrl = window.location.origin;
            
            // Store both short and long URL options
            urlMappings = {
                'home-banner': {
                    short: `${baseUrl}/s/hb`,
                    long: `${baseUrl}/api/track?utm=home-banner`
                },
                'announcement-post': {
                    short: `${baseUrl}/s/ap`,
                    long: `${baseUrl}/api/track?utm=announcement-post`
                },
                'dm-1': {
                    short: `${baseUrl}/s/d1`,
                    long: `${baseUrl}/api/track?utm=dm-1`
                },
                'dm-2': {
                    short: `${baseUrl}/s/d2`,
                    long: `${baseUrl}/api/track?utm=dm-2`
                },
                'dm-3': {
                    short: `${baseUrl}/s/d3`,
                    long: `${baseUrl}/api/track?utm=dm-3`
                },
                'channel-banner': {
                    short: `${baseUrl}/s/cb`,
                    long: `${baseUrl}/api/track?utm=channel-banner`
                },
                'whatsapp-lagos': {
                    short: `${baseUrl}/s/wl`,
                    long: `${baseUrl}/api/track?utm=whatsapp-lagos`
                },
                'whatsapp-johannesburg': {
                    short: `${baseUrl}/s/wj`,
                    long: `${baseUrl}/api/track?utm=whatsapp-johannesburg`
                },
                'whatsapp-kigali': {
                    short: `${baseUrl}/s/wk`,
                    long: `${baseUrl}/api/track?utm=whatsapp-kigali`
                },
                'whatsapp-nairobi': {
                    short: `${baseUrl}/s/wn`,
                    long: `${baseUrl}/api/track?utm=whatsapp-nairobi`
                },
                'whatsapp-casablanca': {
                    short: `${baseUrl}/s/wc`,
                    long: `${baseUrl}/api/track?utm=whatsapp-casablanca`
                },
                'whatsapp-cairo': {
                    short: `${baseUrl}/s/we`,
                    long: `${baseUrl}/api/track?utm=whatsapp-cairo`
                },
                'whatsapp-addis-ababa': {
                    short: `${baseUrl}/s/wa`,
                    long: `${baseUrl}/api/track?utm=whatsapp-addis-ababa`
                },
                'whatsapp-accra': {
                    short: `${baseUrl}/s/wg`,
                    long: `${baseUrl}/api/track?utm=whatsapp-accra`
                }
            };
            
            // Display short URLs by default
            updateUrlDisplay('short');
        }
        
        function toggleUrlDisplay() {
            const selectedType = document.querySelector('input[name="urlType"]:checked').value;
            updateUrlDisplay(selectedType);
        }
        
        function updateUrlDisplay(urlType) {
            document.getElementById('homeBannerUrl').textContent = urlMappings['home-banner'][urlType];
            document.getElementById('announcementUrl').textContent = urlMappings['announcement-post'][urlType];
            document.getElementById('dm1Url').textContent = urlMappings['dm-1'][urlType];
            document.getElementById('dm2Url').textContent = urlMappings['dm-2'][urlType];
            document.getElementById('dm3Url').textContent = urlMappings['dm-3'][urlType];
            document.getElementById('channelBannerUrl').textContent = urlMappings['channel-banner'][urlType];
            
            document.getElementById('whatsappLagosUrl').textContent = urlMappings['whatsapp-lagos'][urlType];
            document.getElementById('whatsappJohannesburgUrl').textContent = urlMappings['whatsapp-johannesburg'][urlType];
            document.getElementById('whatsappKigaliUrl').textContent = urlMappings['whatsapp-kigali'][urlType];
            document.getElementById('whatsappNairobiUrl').textContent = urlMappings['whatsapp-nairobi'][urlType];
            document.getElementById('whatsappCasablancaUrl').textContent = urlMappings['whatsapp-casablanca'][urlType];
            document.getElementById('whatsappCairoUrl').textContent = urlMappings['whatsapp-cairo'][urlType];
            document.getElementById('whatsappAddisAbabaUrl').textContent = urlMappings['whatsapp-addis-ababa'][urlType];
            document.getElementById('whatsappAccraUrl').textContent = urlMappings['whatsapp-accra'][urlType];
        }

        async function loadStats() {
            try {
                document.getElementById('loading').style.display = 'block';
                document.getElementById('error').style.display = 'none';
                document.getElementById('dashboard').style.display = 'none';
                
                const response = await fetch('/api/stats');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                // Update metrics
                document.getElementById('totalClicks').textContent = data.totalClicks || 0;
                document.getElementById('channelCount').textContent = Object.keys(data.channelCounts || {}).length;
                document.getElementById('recentClicks').textContent = data.recentClicks || 0;
                
                // Update channel stats
                const channelStatsDiv = document.getElementById('channelStats');
                if (Object.keys(data.channelCounts || {}).length === 0) {
                    channelStatsDiv.innerHTML = '<div class="loading">No clicks recorded yet</div>';
                } else {
                    const sortedChannels = Object.entries(data.channelCounts)
                        .sort(([,a], [,b]) => b - a);
                    
                    channelStatsDiv.innerHTML = sortedChannels
                        .map(([channel, count]) => `
                            <div class="channel-item">
                                <span><strong>${channel}</strong></span>
                                <span>${count} clicks</span>
                            </div>
                        `).join('');
                }
                
                // Update last updated time
                const lastUpdated = new Date(data.lastUpdated).toLocaleString();
                document.getElementById('lastUpdated').textContent = `Last updated: ${lastUpdated}`;
                
                document.getElementById('loading').style.display = 'none';
                document.getElementById('dashboard').style.display = 'block';
                
            } catch (error) {
                console.error('Error loading stats:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `Error loading data: ${error.message}`;
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', async () => {
            await initializeUrls();
            loadStats();
        });

        // Auto-refresh every 30 seconds
        setInterval(loadStats, 30000);
    </script>
</body>
</html>